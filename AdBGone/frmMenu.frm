VERSION 5.00
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCTL.OCX"
Object = "{248DD890-BB45-11CF-9ABC-0080C7E7B78D}#1.0#0"; "MSWINSCK.OCX"
Begin VB.Form frmMenu 
   BorderStyle     =   0  'None
   ClientHeight    =   5445
   ClientLeft      =   120
   ClientTop       =   405
   ClientWidth     =   4530
   ClipControls    =   0   'False
   ControlBox      =   0   'False
   Icon            =   "frmMenu.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   5445
   ScaleWidth      =   4530
   ShowInTaskbar   =   0   'False
   StartUpPosition =   3  'Windows Default
   Visible         =   0   'False
   Begin Project1.IEEvents IEEvents1 
      Left            =   2520
      Top             =   360
      _ExtentX        =   2831
      _ExtentY        =   344
      Enabled         =   -1  'True
   End
   Begin VB.PictureBox Picture20 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   2160
      Picture         =   "frmMenu.frx":164A
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   19
      Top             =   4680
      Width           =   2010
   End
   Begin VB.PictureBox Picture19 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   2160
      Picture         =   "frmMenu.frx":2D86
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   18
      Top             =   4320
      Width           =   2010
   End
   Begin VB.PictureBox Picture18 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   2160
      Picture         =   "frmMenu.frx":44C2
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   17
      Top             =   3960
      Width           =   2010
   End
   Begin VB.PictureBox Picture17 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   2160
      Picture         =   "frmMenu.frx":5BFE
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   16
      Top             =   3600
      Width           =   2010
   End
   Begin VB.PictureBox Picture16 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   450
      Left            =   2160
      Picture         =   "frmMenu.frx":733A
      ScaleHeight     =   26
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   15
      Top             =   3120
      Width           =   2010
   End
   Begin VB.PictureBox Picture15 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   2160
      Picture         =   "frmMenu.frx":9B4E
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   14
      Top             =   2760
      Width           =   2010
   End
   Begin VB.PictureBox Picture14 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   2160
      Picture         =   "frmMenu.frx":B28A
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   13
      Top             =   2400
      Width           =   2010
   End
   Begin VB.PictureBox Picture13 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   2160
      Picture         =   "frmMenu.frx":C9C6
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   12
      Top             =   2040
      Width           =   2010
   End
   Begin VB.PictureBox Picture12 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   270
      Left            =   2160
      Picture         =   "frmMenu.frx":E102
      ScaleHeight     =   14
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   11
      Top             =   1680
      Width           =   2010
   End
   Begin VB.PictureBox Picture11 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   300
      Left            =   2160
      Picture         =   "frmMenu.frx":F6B6
      ScaleHeight     =   16
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   10
      Top             =   1320
      Width           =   2010
   End
   Begin VB.PictureBox Picture10 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   0
      Picture         =   "frmMenu.frx":10F7A
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   9
      Top             =   4680
      Width           =   2010
   End
   Begin VB.PictureBox Picture9 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   0
      Picture         =   "frmMenu.frx":126B6
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   8
      Top             =   4320
      Width           =   2010
   End
   Begin VB.PictureBox Picture8 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   0
      Picture         =   "frmMenu.frx":13DF2
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   7
      Top             =   3960
      Width           =   2010
   End
   Begin VB.PictureBox Picture7 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   0
      Picture         =   "frmMenu.frx":1552E
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   6
      Top             =   3600
      Width           =   2010
   End
   Begin VB.PictureBox Picture6 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   435
      Left            =   0
      Picture         =   "frmMenu.frx":16C6A
      ScaleHeight     =   25
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   5
      Top             =   3120
      Width           =   2010
   End
   Begin VB.PictureBox Picture5 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   0
      Picture         =   "frmMenu.frx":192F6
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   4
      Top             =   2760
      Width           =   2010
   End
   Begin VB.PictureBox Picture4 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   0
      Picture         =   "frmMenu.frx":1AA32
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   3
      Top             =   2400
      Width           =   2010
   End
   Begin VB.PictureBox Picture3 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   285
      Left            =   0
      Picture         =   "frmMenu.frx":1C16E
      ScaleHeight     =   15
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   2
      Top             =   2040
      Width           =   2010
   End
   Begin VB.PictureBox Picture2 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   270
      Left            =   0
      Picture         =   "frmMenu.frx":1D8AA
      ScaleHeight     =   14
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   1
      Top             =   1680
      Width           =   2010
   End
   Begin VB.PictureBox Picture1 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   300
      Left            =   0
      Picture         =   "frmMenu.frx":1EE5E
      ScaleHeight     =   16
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   130
      TabIndex        =   0
      Top             =   1320
      Width           =   2010
   End
   Begin MSWinsockLib.Winsock wskContrib 
      Left            =   1800
      Top             =   120
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   393216
   End
   Begin MSWinsockLib.Winsock wskAdv 
      Index           =   0
      Left            =   1800
      Top             =   720
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   393216
   End
   Begin MSWinsockLib.Winsock wskHost 
      Left            =   1200
      Top             =   720
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   393216
   End
   Begin MSWinsockLib.Winsock wskMain 
      Left            =   1200
      Top             =   120
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   393216
   End
   Begin MSComctlLib.ImageList ImageList1 
      Left            =   480
      Top             =   120
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   13
      ImageHeight     =   13
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   7
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmMenu.frx":20722
            Key             =   ""
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmMenu.frx":2097E
            Key             =   ""
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmMenu.frx":20BDA
            Key             =   ""
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmMenu.frx":20E36
            Key             =   ""
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmMenu.frx":21092
            Key             =   ""
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmMenu.frx":212EE
            Key             =   ""
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmMenu.frx":2154A
            Key             =   ""
         EndProperty
      EndProperty
   End
   Begin VB.Menu menuMain 
      Caption         =   "main"
      Begin VB.Menu menuProtection 
         Caption         =   "Protection"
         Begin VB.Menu menuProton 
            Caption         =   "Enabled"
         End
         Begin VB.Menu menuProtoff 
            Caption         =   "Disabled"
            Checked         =   -1  'True
         End
      End
      Begin VB.Menu menuInsert2 
         Caption         =   "-"
      End
      Begin VB.Menu menuContrib 
         Caption         =   "Contribute host..."
      End
      Begin VB.Menu menuUpdate 
         Caption         =   "Update hosts..."
      End
      Begin VB.Menu menuEdit 
         Caption         =   "Edit hosts..."
      End
      Begin VB.Menu menuInsert3 
         Caption         =   "-"
      End
      Begin VB.Menu menuRestore 
         Caption         =   "Restore"
      End
      Begin VB.Menu menuSettings 
         Caption         =   "Settings..."
      End
      Begin VB.Menu menuAbout 
         Caption         =   "About..."
      End
      Begin VB.Menu menuClose 
         Caption         =   "Exit"
      End
   End
   Begin VB.Menu menuMain2 
      Caption         =   "main2"
      Begin VB.Menu menuERemove 
         Caption         =   "Remove"
      End
   End
End
Attribute VB_Name = "frmMenu"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False




Private Sub Form_MouseMove(Button As Integer, Shift As Integer, x As Single, y As Single)

    '' If theres a flag disabling the menu from opening return
    If menu_cancel_flag Then Exit Sub
    
    Static lngMsg As Long
    Static blnFlag As Boolean
    Dim result As Long
    
    '' Calculate twips to pixels
    lngMsg = x / Screen.TwipsPerPixelX
    

    If blnFlag = False Then
        blnFlag = True

        '' Depending on the message returned, select the action
        Select Case lngMsg
            
            '' User double clicked icon
            Case WM_LBUTTONDBLCLICK
                '' Show the about box
                frmMain.Show
            
            '' User right clicked icon
                Case WM_RBUTTONUP
                    '' Set me as the active window
                    '' so the menu will disapear when focus
                    '' is lost
                    result = SetForegroundWindow(Me.hwnd)
                    '' Pop up the menu
                    Me.PopupMenu menuMain
            
        End Select


    blnFlag = False
End If

End Sub




Private Sub IEEvents1_NewWindow(Browser As SHDocVw.InternetExplorer, ppDisp As Object, Cancel As Boolean)


'' Check to see if blocking popups is enabled, then proceed to block



If block_popups And Val(Browser.QueryStatusWB(OLECMDID_NEW)) = 1 Then

    popup_count = popup_count + 1

    tray_update frmMenu, build_title & " (enabled)" & vbCrLf & "Ads blocked: " & advertisement_count & vbCrLf & "PopUps blocked: " & popup_count

    If Not reg_registered Then
        reg_count = reg_count + 1
        reg_unregCheckCount
    End If
    
    Cancel = True
    
End If

End Sub

Private Sub menuAbout_Click()

    '' Show the about form
    frmMain.Show
    
End Sub

Private Sub menuClose_Click()

    '' Unload everything and quit
    end_Main
    
End Sub



Private Sub menuContrib_Click()
    
    '' Show the contribution form
    frmContribute.Show
    
End Sub

Private Sub menuEdit_Click()
    
    '' Show the edit hosts form
    load_EditHosts
    
End Sub

Private Sub menuERemove_Click()

    '' Remove an item from the hosts list
    On Error Resume Next
        With frmHosts.lstHosts
            .ListItems.Remove .SelectedItem.Index
        End With
        
        frmHosts.Caption = build_title & " -- Hosts (" & frmHosts.lstHosts.ListItems.Count & ")"
        
End Sub


Private Sub menuProtoff_Click()

    '' Disable protection
    If menuProtoff.Checked = True Then Exit Sub

    disable_Protection
    
End Sub

Private Sub menuProton_Click()

    '' Enable protection
    If menuProton.Checked = True Then Exit Sub
    
    If Not verify_Hostfile() Then
        MsgBox "You need to update your hosts file first.", vbInformation, build_title
        Exit Sub
    End If
    
    enable_Protection
        
End Sub

Private Sub menuRestore_Click()
    
    '' Restore all modified settings
    
    '' Remove AdBGone's registry entries
    With registry_entry
        .hkey = HKEY_CURRENT_USER
        
        .KeyRoot = "Software"
        .Subkey = ""
        
        .DeleteKey build_title
        
        .KeyRoot = "Software\Microsoft\Windows\CurrentVersion\Run"
        .Subkey = ""
        
        .DeleteValue build_title
    End With

    '' Restore old hosts file
    If verify_Backupfile Then
        On Error Resume Next
        Close #1
        Close #2
        Open backup_file For Input As #1
        Open windows_hosts_file For Output As #2
            While Not EOF(1)
                Line Input #1, temp_data
                Print #2, temp_data
            Wend
        Close #1
        Close #2
        
        Kill backup_file
    End If
    
    '' Delete saved files
    On Error Resume Next
    Kill hosts_file
    Kill html_file
    
    '' Notify the user
    MsgBox "Settings restored, " & build_title & " will now exit.", vbInformation, build_title
    
    '' Unload and quit
    end_Main 1
    
End Sub

Private Sub menuSettings_Click()

    '' Show the configuration dialog
    frmConfig.Show
    
End Sub

Private Sub menuUpdate_Click()

    '' Update hosts file from adbgone server
    update_Hosts
    
End Sub






Private Sub wskHost_ConnectionRequest(ByVal requestID As Long)
        
    '' If there is an error, ignore it
    On Error Resume Next
    '' If there is a connection from a computer other than this
    '' computer, do NOT allow them to connect
    If Not wskHost.RemoteHostIP = localhost Then Exit Sub
    '' Enable the connection
    Load wskAdv(requestID)
    wskAdv(requestID).Accept requestID
    '' Send the advertisement replacement data to the selected
    '' connection
    send_adv_data requestID

End Sub

Private Sub wskMain_DataArrival(ByVal bytesTotal As Long)

    '' If there is an error, ignore it
    On Error Resume Next
    '' Temporary variable
    Dim data_temp As String
    '' Retrieve the data being sent in
    wskMain.GetData data_temp, vbString


    '' net_mode 1 = Request sent, waiting for download to finish
    If net_mode = 1 Then
        '' Save the data
        net_data = data_temp
        '' Reset the mode
        net_mode = 0
        '' Notify the function
        net_flag = True
    End If
    
    '' net_mode 2 = downloading data, a string will set off the flag
    If net_mode = 2 Then
        '' Replace chr(10)'s with full line breaks
        net_data = net_data & Replace(Replace(data_temp, Chr(10), Chr(13) & Chr(10)), "-- end --", "")
        '' If the string is found, notify the function
        If InStr(data_temp, "-- end --") Then
            net_flag = True
            net_mode = 0
        End If
    End If
        
End Sub

